# ğŸ“„ éº¦éº¦çŸ¥è¯†åº“ï¼ˆæ–°ç‰ˆLPMMï¼‰ä½¿ç”¨è¯´æ˜

## æ³¨æ„äº‹é¡¹

::: danger æé†’
è¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹æ³¨æ„äº‹é¡¹ï¼Œä»¥å…å¼•èµ·ä¸å¿…è¦çš„éº»çƒ¦ä¸æ”¯å‡º
:::
:::info
1. **çŸ¥è¯†æå–å‰ï¼Œè¯·ç¡®ä¿ä½ çš„æ–‡æœ¬åˆ†æ®µè‰¯å¥½ï¼Œæ²¡æœ‰å¥‡æ€ªå­—ç¬¦ï¼Œå¦åˆ™æå–ç»“æœå¯èƒ½å¾ˆä¸ç†æƒ³ç”šè‡³ä¼šå¯¼è‡´æå–å¤±è´¥**

2. **çŸ¥è¯†æå–æ—¶ï¼Œéœ€è¦å°†æ–‡æœ¬å¤§é‡è¾“å…¥å¤§æ¨¡å‹ï¼Œè¶Šé•¿çš„æ–‡æœ¬æ¶ˆè€—è¶Šå¤§ï¼Œäº§ç”Ÿçš„èŠ±è´¹è¶Šé«˜**

   æ¥è‡ªç¾¤å‹çš„æƒ¨ç—›ç»å†ï¼š600ä¸‡å­—å…¨å‰§æƒ…ï¼Œæå–é€‰ç”¨deepseek v3 0324ï¼Œæ¶ˆè€—çº¦40å…ƒï¼Œæœ›å„ä½ä»¥æ­¤ä¸ºæˆ’ã€‚  
   å¦‚æœè¦æ±‚ä¸é«˜å»ºè®®é‡‡ç”¨32B~72Bå°çš„å¤§æ¨¡å‹æ¥æå–ï¼Œä½†æ˜¯ä¸å»ºè®®ä½¿ç”¨32Bä»¥ä¸‹çš„å°æ¨¡å‹ï¼Œå¦åˆ™æå–æ•ˆæœéå¸¸å·®è€Œä¸”æå…¶å¯èƒ½å¤±è´¥ã€‚
   ï¼ˆå¦‚æœä»ç„¶æƒ³è¦é€‰ç”¨deepseek v3æ¥è¿›è¡Œæå–ï¼Œç¬”è€…åœ¨æ­¤æ¨è[DeepSeek](https://www.deepseek.com/)ï¼Œ[ä¸Šä¸‹æ–‡ç¡¬ç›˜ç¼“å­˜](https://api-docs.deepseek.com/zh-cn/guides/kv_cache)ä¼šå¸®åŠ©ä½ èŠ‚çº¦é‡‘é’±ï¼‰

3. **çŸ¥è¯†å¯¼å…¥æ—¶ï¼Œä¼šå¤§é‡å‘é€è¯·æ±‚ï¼Œå¯èƒ½ä¼šæ’åˆ°è¯·æ±‚é€Ÿåº¦ä¸Šé™ï¼Œè¯·æ³¨æ„é€‰ç”¨çš„æ¨¡å‹ï¼ˆå¯ç”¨æœ¬åœ°embeddingæ¨¡å‹ï¼‰**

   ï¼ˆåŒä¸Šæ ·ä¾‹ï¼šåœ¨æœ¬åœ°æ¨¡å‹ä¸‹ï¼Œåœ¨70åˆ†é’Ÿå†…æˆ‘ä»¬å‘é€äº†çº¦8ä¸‡æ¡è¯·æ±‚ï¼Œåœ¨ç½‘ç»œå…è®¸ä¸‹ï¼Œé€Ÿåº¦ä¼šæ›´å¿«ï¼‰

4. **çŸ¥è¯†å¯¼å…¥æ—¶ï¼Œä¼šæ¶ˆè€—å¤§é‡ç³»ç»Ÿèµ„æºï¼Œå»ºè®®åœ¨è¾ƒå¥½é…ç½®ç”µè„‘ä¸Šè¿è¡Œ**

   ï¼ˆåŒä¸Šæ ·ä¾‹ï¼šå¯¼å…¥æ—¶10700Kå‡ ä¹è·‘æ»¡ï¼Œå³°å€¼å†…å­˜å ç”¨çº¦3Gï¼‰

5. **æœ¬çŸ¥è¯†åº“ä¸æ—§ç‰ˆä¸å…¼å®¹**ï¼Œå¦‚æœéœ€è¦å°†æ—§ç‰ˆæ•°æ®åº“ä¸­å†…å®¹è¿ç§»åˆ°æ–°ç‰ˆï¼Œè¯·é‡æ–°å¯¼å…¥
:::


## å®‰è£…
å¯¹äº Windows_x86_64 å¹³å°çš„ç”¨æˆ·ï¼Œ**è¯·ä½¿ç”¨pipè¿›è¡Œç›´æ¥å®‰è£…**ã€‚ï¼ˆå·²ç»åŒ…å«åœ¨MaiBotçš„requirements.txtä¸­ï¼Œæ— éœ€æ‰‹åŠ¨ï¼‰  

å¯¹äº Linux å¹³å°ç”¨æˆ·ï¼Œéœ€è¦ä¸‹è½½gcc/g++ç¼–è¯‘å™¨ï¼Œè·³è½¬é“¾æ¥: [Linuxç¯å¢ƒä½¿ç”¨æ–¹æ³•](#linux)  

å¯¹äº MacOS å¹³å°ç”¨æˆ·è¯·ç›´æ¥å‚è€ƒ[è¿™ä¸ªé“¾æ¥](/manual/usage/compile_and_install)çš„ MacOS æ‰‹åŠ¨ç¼–è¯‘éƒ¨åˆ†

å¯¹äºDockerç”¨æˆ·é…ç½®å®Œæˆåå¯ä»¥ç›´æ¥è¿è¡Œè„šæœ¬ï¼ˆLPMMå·²é¢„ç¼–è¯‘äºé•œåƒä¸­ï¼‰ï¼Œè·³è½¬é“¾æ¥: [Dockerçš„LPMMé£Ÿç”¨æ–¹å¼](#dockerçš„lpmmé£Ÿç”¨æ–¹å¼)
::: tip
å¦‚æœä½ å¤šæ¬¡å°è¯•å®‰è£…åï¼Œ**å‘ç°ç¡®å®æ²¡æœ‰å¯¹åº”ä½ å¹³å°çš„ç‰ˆæœ¬**ï¼Œè¯·å‚è€ƒ[è¿™ä¸ªé“¾æ¥](/manual/usage/compile_and_install)çš„å†…å®¹è¿›è¡Œæ‰‹åŠ¨ç¼–è¯‘ã€‚
:::

### Windows
ç›´æ¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
```bash
pip install quick_algo
```

### Linux
1. é¦–å…ˆå®‰è£…gcc/g++ç¼–è¯‘å™¨

åŸºäºDebiançš„ç³»ç»Ÿï¼ˆå¦‚Ubuntuã€Linux Mintç­‰ï¼‰

```bash
# æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•
sudo apt update
# è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…`gcc`å’Œ`g++`ï¼š
sudo apt install build-essential
```

åŸºäºRed Hatçš„ç³»ç»Ÿï¼ˆå¦‚Fedoraã€CentOSã€RHELç­‰ï¼‰

```bash
# æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•
sudo dnf check-update
# å®‰è£…`gcc`å’Œ`g++`
sudo dnf install gcc gcc-c++
# å¦‚æœä½¿ç”¨çš„æ˜¯`yum`ï¼Œå°†`dnf`æ›¿æ¢ä¸º`yum`å³å¯
```

2. éªŒè¯å®‰è£…

å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯`gcc`å’Œ`g++`æ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœå®‰è£…æˆåŠŸï¼Œä¼šæ˜¾ç¤º`gcc`å’Œ`g++`çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚

```bash
gcc --version
g++ --version
```

3. å®‰è£… LPMM å¿…å¤‡åº“`quick_algo`

æ¿€æ´»ä½ ä½¿ç”¨çš„è™šæ‹Ÿç¯å¢ƒï¼Œè¿è¡Œ:

```bash
source ./venv/bin/activate #æ¿€æ´»MaiBotè™šæ‹Ÿç¯å¢ƒ
pip install quick-algo
```


## é…ç½®LPMM

æŠŠ`template/lpmm_config_template.toml`å¤åˆ¶åˆ°`config/lpmm_config.toml`ï¼ŒæŒ‰ç…§æ ·ä¾‹é…ç½®`provider`å’Œä½¿ç”¨çš„æ¨¡å‹ã€‚

å…¶å¯¹åº”çš„è¯´æ˜å‡å­˜åœ¨äºé…ç½®æ–‡ä»¶æ³¨é‡Šä¸­ï¼Œæ­¤å¤„ç•¥ã€‚

## éº¦éº¦å­¦ä¹ çŸ¥è¯†

::: tip
1. çŸ¥è¯†åº“ä½¿ç”¨çš„æ–‡æœ¬å¿…é¡»ä»¥txtæ ¼å¼å­˜å‚¨

2. å®ä½“æå–ã€RDFæå–çš„æ¨¡å‹ä¸å»ºè®®ä½¿ç”¨32Bä»¥ä¸‹çš„å°æ¨¡å‹ï¼Œå¦åˆ™æå–æ•ˆæœéå¸¸å·®è€Œä¸”æå…¶å¯èƒ½å¤±è´¥
:::

### åˆ†æ®µ

é¦–å…ˆï¼Œç¡®ä¿ä½ çš„æ–‡æœ¬åˆ†æ®µè‰¯å¥½ã€‚

åˆ†æ®µæ–¹å¼ï¼šæŒ‰ç…§åŒä¸€ä¸»é¢˜ï¼Œè®¾ç½®ä¸€ä¸ªå¤§æ®µè½ï¼Œæ¯ä¸ªæ®µè½ä¹‹é—´æœ‰ä¸€ä¸ªç©ºè¡Œã€‚ç›¸é‚»çš„è‡ªç„¶æ®µå°†è®¤ä¸ºæ˜¯ä¸€ä¸ªå¤§æ®µè½ã€‚æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š

```
ç²¾ç¥çŠ¶æ€è‰¯å¥½ï¼šå½¢å®¹è‡ªå·±ç²¾ç¥çŠ¶æ€è‰¯å¥½çš„åè®½ï¼Œå®é™…ç²¾ç¥çŠ¶æ€éå¸¸ä¸ç¨³å®šã€‚

èººå¹³ï¼šæ˜¯ä¸€ä¸ªç½‘ç»œçƒ­æ¢—ã€‚æŒ‡æ— è®ºå¯¹æ–¹åšå‡ºä»€ä¹ˆååº”ï¼Œå†…å¿ƒéƒ½æ¯«æ— æ³¢æ¾œï¼Œå¯¹æ­¤ä¸ä¼šæœ‰ä»»ä½•ååº”æˆ–è€…åæŠ—ï¼Œè¡¨ç¤ºé¡ºä»å¿ƒç†ï¼Œä¹Ÿè¡¨ç¤ºä¸å†çƒ­è¡€æ²¸è…¾çš„çŠ¶æ€ã€‚

å†…å·ï¼šæŒ‡ä¸€ç±»æ–‡åŒ–æ¨¡å¼è¾¾åˆ°äº†æŸç§æœ€ç»ˆçš„å½¢æ€ä»¥åï¼Œæ—¢æ²¡æœ‰åŠæ³•ç¨³å®šä¸‹æ¥ï¼Œä¹Ÿæ²¡æœ‰åŠæ³•è½¬å˜ä¸ºæ–°çš„å½¢æ€ï¼Œè€Œåªèƒ½ä¸æ–­åœ°åœ¨å†…éƒ¨å˜å¾—æ›´åŠ å¤æ‚çš„ç°è±¡ç§°ä¸º"å†…å·åŒ–"ã€‚
ç°åœ¨æµè¡Œæˆäº†ä¸€ä¸ªå­—ï¼Œ"å·"ï¼Œå¾ˆå¤šé«˜æ ¡å­¦ç”Ÿç”¨å…¶æ¥æŒ‡éç†æ€§çš„å†…éƒ¨ç«äº‰æˆ–"è¢«è‡ªæ„¿"ç«äº‰ã€‚
ç°åº”ç”¨åœ¨å„è¡Œå„ä¸šä»¥åŠå„ä¸ªé¢†åŸŸä¸­çš„ç«äº‰ï¼ŒæŒ‡åŒè¡Œé—´ç«ç›¸ä»˜å‡ºæ›´å¤šåŠªåŠ›ä»¥äº‰å¤ºæœ‰é™èµ„æºï¼Œä»è€Œå¯¼è‡´ä¸ªä½“"æ”¶ç›ŠåŠªåŠ›æ¯”"ä¸‹é™çš„ç°è±¡ã€‚

å‡¡å°”èµ›ï¼šæºè‡ªäºå¾®åšä¸Šçš„æ™’å¯Œè¡Œä¸ºï¼Œå½¢å®¹é‚£äº›æ•…æ„ç‚«è€€è‡ªå·±ã€è¡¨ç°è‡ªå·±å¯Œæœ‰çš„äººæˆ–è¡Œä¸ºï¼Œè®½åˆºæ„å‘³åè¶³ã€‚

ç¤¾æ­»ï¼šå½¢å®¹æŸä¸ªäººåœ¨å…¬å…±åœºåˆå‡ºç°æ—¶ï¼Œå› æŸç§åŸå› æ„Ÿåˆ°æå…¶å°´å°¬å’Œä¸å¥½æ„æ€ï¼Œè¡¨ç°å‡ºäº†äººä»¬åœ¨ç¤¾ä¼šäº¤å¾€ä¸­çš„ç§ç§å°´å°¬æƒ…æ™¯ã€‚
```

::: warning è­¦å‘Š
**è¾“å…¥æ•°æ®çš„åˆ†å‰²è´¨é‡å°†ç›´æ¥å½±å“çŸ¥è¯†å›¾è°±çš„æ„å»ºæ•ˆæœï¼Œè¯·ç¡®ä¿å¯¹è¯æ®µè½è¯­ä¹‰å®Œæ•´ï¼**
:::

### å¯¼å…¥

æ–°ç‰ˆLPMMè¿›è¡Œäº†æ”¹è¿›ï¼š

é¦–å…ˆï¼ŒæŠŠåŸå§‹æ–‡ä»¶æ”¾åˆ°`data/lpmm_raw_data`(æ²¡æœ‰è¯·è‡ªè¡Œåˆ›å»º)
æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ(**å·²æ¿€æ´»è¯·è·³è¿‡**)ï¼š

```bash
#Windowsä¸‹:
.\MaiBot\venv\Scripts\activate
#Liunxç¯å¢ƒ:
source ./venv/bin/activate
```

è¿è¡Œ`info_extraction.py`æ¥è¿›è¡Œæ–‡æœ¬åˆ†å‰² & å®ä½“æå–ã€‚

```bash
python ./scripts/info_extraction.py
```

æå–ç»“æŸåï¼Œä½ ä¼šåœ¨`data/openie`ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ª`æœˆ-æ—¥-æ—¶-åˆ†-openie.json`æ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æå–å¥½çš„OpenIEæ•°æ®ã€‚

åŒæ ·ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠå…¶ä»–äººåˆ†äº«å‡ºæ¥çš„openie.jsonæ–‡ä»¶æ”¾åˆ°`data/openie`ç›®å½•ä¸‹ï¼Œç›´æ¥ä½¿ç”¨ã€‚

è¿™ä¸ªæ–‡ä»¶å‘½åä¸å†åƒä¹‹å‰ä¸€æ ·å¿…é¡»ä¸¥æ ¼è§„èŒƒï¼Œå¯ä»¥ä½¿ç”¨è‡ªå·±å–œæ¬¢çš„å‘½åæ–¹å¼ã€‚ä½†éœ€è¦ä¿è¯æ–‡ä»¶åç¼€ä¸º`.json`ã€‚

æœ€åï¼Œè¿è¡Œ`import_openie.py`æ¥è¿›è¡Œæœ€åçš„çŸ¥è¯†å›¾è°±å¯¼å…¥ã€‚

```bash
python ./scripts/import_openie.py
```

å¯¼å…¥å®Œæˆåï¼Œå¦‚æœå¯ä»¥åœ¨dataæ–‡ä»¶å¤¹ä¸‹çœ‹è§`rag`å’Œ`embedding`ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œè¯´æ˜å¯¼å…¥æˆåŠŸã€‚

## éº¦éº¦LPMMåŠ é€Ÿ

:::tip
GPUåŠ é€Ÿä»…é€‚ç”¨äºç³»ç»Ÿä¸ºLinux,NVIDIA RTX20ç³»åŠä»¥ä¸Šæ˜¾å¡åŠä¸“ä¸šå¡
:::

å®‰è£…æ–¹å¼ï¼š

```bash
# å¸è½½cpuç‰ˆ
pip uninstall faiss-cpu
# è£…cuda11ç‰ˆ
pip install faiss-gpu-cu11
# è£…cuda12ç‰ˆ
pip install faiss-gpu-cu12
```

ä½¿ç”¨Condaæ—¶ï¼ŒGPUåŠ é€Ÿä»…é€‚ç”¨äºLinuxï¼š
è¯¦è§[faisså®˜æ–¹æ–‡æ¡£](https://github.com/facebookresearch/faiss/blob/main/INSTALL.md)
ä½¿ç”¨æ–¹å¼ï¼š

```bash
# CPU-only version
$ conda install -c pytorch faiss-cpu=1.11.0

# GPU(+CPU) version
$ conda install -c pytorch -c nvidia faiss-gpu=1.11.0

# GPU(+CPU) version with NVIDIA cuVS
$ conda install -c pytorch -c nvidia -c rapidsai -c conda-forge libnvjitlink faiss-gpu-cuvs=1.11.0

# GPU(+CPU) version using AMD ROCm not yet available
```

## Dockerçš„LPMMé£Ÿç”¨æ–¹å¼

é¦–å…ˆä»GitHubä¸Šæ‹‰å–é…ç½®ï¼š

```bash
# githubå¦‚ä¸å¯ç”¨è¯·ä½¿ç”¨é•œåƒåŠ é€Ÿ
wget https://github.com/MaiM-with-u/MaiBot/raw/refs/heads/main/template/lpmm_config_template.toml -O docker-config/mmc/lpmm_config.toml
```

ç„¶åæŒ‰ç…§æ ·ä¾‹é…ç½®`provider`

:::tip
å®ä½“æå–ã€RDFæå–çš„æ¨¡å‹ä¸å»ºè®®ä½¿ç”¨32Bä»¥ä¸‹çš„å°æ¨¡å‹ï¼Œå¦åˆ™æå–æ•ˆæœéå¸¸å·®è€Œä¸”æå…¶å¯èƒ½å¤±è´¥
:::

ç„¶ååˆ›å»ºæ–‡ä»¶å¤¹

```bash
mkdir -p data/MaiMBot/lpmm_raw_data
```

æŠŠä½ çš„åŸå§‹çŸ¥è¯†å¡å…¥lpmm_raw_data
> æ ¼å¼è¦æ±‚è§[éº¦éº¦å­¦ä¹ çŸ¥è¯†](#éº¦éº¦å­¦ä¹ çŸ¥è¯†)

ç„¶åè¿è¡Œå‘½ä»¤ï¼š

```bash
docker run -it -v ./data/MaiMBot:/MaiMBot/data -v ./docker-config/mmc:/MaiMBot/config -v ./docker-config/mmc/.env:/MaiMBot/.env --network maim-bot_maim_bot  --entrypoint bash sengokucola/maibot:latest "scripts/run_lpmm.sh"
```

:::tip
æ³¨æ„æ­¤å¤„çš„`network`é…ç½®ï¼Œåº”ä¸ºä½ çš„coreæ‰€åœ¨çš„dockerç½‘ç»œï¼Œå¯ä½¿ç”¨`docker network ls`æŸ¥æ‰¾ä½ çš„ç½‘ç»œåç§°ï¼Œåç§°åé¢æœ‰`maim_bot`å­—æ ·çš„ç½‘ç»œå³ä¸ºä½ çš„coreæ‰€åœ¨ç½‘ç»œ  
ä¾‹ï¼š

```bash
$ docker network ls
NETWORK ID     NAME              DRIVER    SCOPE
8f5c55aec8a1   bridge            bridge    local
9e3966fa583e   host              host      local
ec92e2f103a4   maibot_maim_bot   bridge    local  # è¿™ä¸ªå°±æ˜¯éº¦éº¦çš„dockerç½‘ç»œ
cb43a6a60ed3   none              null      local
```
:::

è¿è¡Œå®Œæˆå‡ºç°`âœ… All scripts completed successfully`é‚£ä¹ˆä½ çš„çŸ¥è¯†åº“å°±å¯¼å…¥æˆåŠŸäº†
